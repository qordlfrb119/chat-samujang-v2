<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ  ì±—ì‚¬ë¬´ì¥ - ë¶€ë™ì‚° ê²½ë§¤ ë¶„ì„</title>
  <style>
    body {
      font-family: 'Malgun Gothic', sans-serif;
      max-width: 700px;
      margin: 40px auto;
      padding: 20px;
    }
    h1 {
      color: #333;
    }
    input, button {
      font-size: 16px;
      padding: 10px;
      margin: 10px 0;
      width: 100%;
    }
    #result, #chatBox {
      white-space: pre-wrap;
      background: #f8f8f8;
      padding: 20px;
      border-radius: 6px;
      margin-top: 20px;
      min-height: 100px;
    }
  </style>
</head>
<body>
  <h1>ğŸ“„ ì±—ì‚¬ë¬´ì¥</h1>
  <p>ëŒ€ë²•ì› ê²½ë§¤ ì‚¬ì´íŠ¸ì—ì„œ ì €ì¥í•œ HTML íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.</p>

  <!-- ğŸ“ HTML ì—…ë¡œë“œ -->
  <form id="uploadForm">
    <input type="file" id="htmlFile" accept=".html" multiple />
    <button type="submit">ğŸ” ë¶„ì„ ìš”ì²­</button>
  </form>

  <div id="result">ğŸ“„ ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>

  <!-- ğŸ’¬ ì‚¬ìš©ì ì§ˆë¬¸ì°½ -->
  <h2>ğŸ’¬ ë¶„ì„ ê²°ê³¼ì— ëŒ€í•´ GPTì—ê²Œ ì§ˆë¬¸í•˜ê¸°</h2>
  <input type="text" id="question" placeholder="ê¶ê¸ˆí•œ ì ì„ ì…ë ¥í•˜ì„¸ìš”" />
  <button onclick="askQuestion()">ì§ˆë¬¸í•˜ê¸°</button>

  <div id="chatBox">ğŸ¤– GPTì˜ ë‹µë³€ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>

  <script>
    let lastAnalysisResult = "";  // ë¶„ì„ ê²°ê³¼ë¥¼ ê¸°ì–µí•´ì„œ ì§ˆë¬¸ ì‹œ ì „ë‹¬ìš©

    // HTML ì—…ë¡œë“œ ì²˜ë¦¬
    document.getElementById("uploadForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const file = document.getElementById("htmlFile").files[0];
      const resultBox = document.getElementById("result");

      if (!file) {
        alert("HTML íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
      }

      const formData = new FormData();
      formData.append("file", file);

      resultBox.textContent = "â³ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...";

      try {
        const res = await fetch("https://chat-samujang-v2.onrender.com/api/analyze", {
          method: "POST",
          body: formData
        });

        const data = await res.json();
        const formatted = JSON.stringify(data, null, 2);
        lastAnalysisResult = formatted;
        resultBox.textContent = formatted;
      } catch (err) {
        resultBox.textContent = "âŒ ë¶„ì„ ì‹¤íŒ¨: " + err.message;
      }
    });

    // ì§ˆë¬¸ ê¸°ëŠ¥ ì²˜ë¦¬
    async function askQuestion() {
      const question = document.getElementById("question").value.trim();
      const chatBox = document.getElementById("chatBox");

      if (!lastAnalysisResult) {
        alert("ë¨¼ì € HTML íŒŒì¼ì„ ì—…ë¡œë“œí•´ ë¶„ì„ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.");
        return;
      }
      if (!question) {
        alert("ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      chatBox.textContent = "ğŸ¤” GPTì—ê²Œ ì§ˆë¬¸ ì¤‘...";

      try {
        const res = await fetch("https://chat-samujang-v2.onrender.com/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            analysis: lastAnalysisResult,
            question: question
          })
        });

        const data = await res.json();
        chatBox.textContent = data.answer;
      } catch (err) {
        chatBox.textContent = "âŒ ì§ˆë¬¸ ì²˜ë¦¬ ì‹¤íŒ¨: " + err.message;
      }
    }
 <script>
    document.getElementById("uploadForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const files = document.getElementById("htmlFiles").files;
      const resultBox = document.getElementById("result");

      if (files.length !== 2) {
        alert("ìƒì„¸í˜ì´ì§€ HTMLê³¼ ë§¤ê°ë¬¼ê±´ëª…ì„¸ì„œ HTML ì´ 2ê°œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
      }

      const formData = new FormData();
      for (const file of files) {
        formData.append("file", file);
      }

      resultBox.textContent = "â³ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...";

      try {
        const res = await fetch("https://chat-samujang-v2.onrender.com/api/analyze", {
          method: "POST",
          body: formData
        });

        const data = await res.json();
        resultBox.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        resultBox.textContent = "âŒ ë¶„ì„ ì‹¤íŒ¨: " + err.message;
      }
    });
  </script>
</body>
</html>
